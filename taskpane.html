<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!doctype html>
<html>
  <head>
    <!-- Office JavaScript API -->
    <script
      type="text/javascript"
      src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
    ></script>
    <script
      type="text/javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    ></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.14.0/jquery-ui.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/luxon@3.5.0/build/global/luxon.min.js"
    ></script>
    <link
      href="https://unpkg.com/tabulator-tables@6.2.5/dist/css/tabulator.min.css"
      rel="stylesheet"
    />
    <script
      type="text/javascript"
      src="https://unpkg.com/tabulator-tables@6.2.5/dist/js/tabulator.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/tabulator-tables@6.2.5/dist/js/jquery_wrapper.js"
    ></script>

    <script defer type="module" src="src/vertex_ai.js"></script>
    <script defer type="module" src="src/addin.js"></script>
    <link rel="stylesheet" href="taskpane.css" />
    <title>Velvet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style></style>
  </head>

  <body>
    <div class="container">
      <h1 class="title">Vertex AI Tools</h1>
      <section class="step">
        <h2 class="step-title">Authentication</h2>

        <p>
          <label for="access-token">Access Token:</label>
          <input type="text" id="access-token" placeholder="Paste Access Token" size="100" />
        </p>
      </section>
      <ul class="tabs">
        <li class="tab active" data-target="search-tab">Search Eval</li>
        <li class="tab" data-target="qa-tab">Synthetic Q&A</li>
        <li class="tab" data-target="summarization-tab">Summarization</li>
      </ul>

      <div class="tab-content active" id="search-tab">
        <section class="step">
          <h2 class="step-title">Agent Builder Search Testing</h2>
          <p><button id="createSearchTables">Create Search Tables</button></p>
          <p>
            1. Modify Config Parameters in first table. 2. Populate ID, Query, Actual Summary,
            Expected Summary etc. and Click button below.
          </p>
          <button id="executeSearchTests">Run Tests</button>
          <button id="cancelSearchTests" style="visibility: hidden; background: red">
            Cancel Tests
          </button>
        </section>
      </div>

      <div class="tab-content" id="qa-tab">
        <section class="step">
          <h2 class="step-title">Synthetic Q&A Generation</h2>
          <p><button id="createGenQATables">Create Q&A Tables</button></p>
          <p>
            1. Modify Config Parameters in first table. 2. Populate ID, FileUri and mimeType in
            second table and Click button below.
          </p>
          <button id="generateQAData">Generate Q&A</button>
          <button id="cancelGenerateQAData" style="visibility: hidden; background: red">
            Cancel Generate Q&A
          </button>
        </section>
      </div>

      <div class="tab-content" id="summarization-tab">
        <section class="step">
          <h2 class="step-title">Summarization Eval</h2>
          <p>
            <button id="createSummarizationTables">Create Summarization Tables</button>
          </p>
          <p>
            1. Modify Config Parameters in first table. 2. Populate ID and Context in second table
            and Click button below.
          </p>
          <button id="genSummarizationData">Run Eval</button>
          <button id="cancelSummarizationData" style="visibility: hidden; background: red">
            Cancel Summary Eval
          </button>
        </section>
      </div>

      <section class="status">
        <h2 class="status-title">Status</h2>
        <div class="status"></div>
      </section>
      <section class="logs">
        <button id="toggleLogs">Show/Hide Logs</button>
        <div class="log-container">
          <div id="log-pane" style="display: none"></div>
        </div>
      </section>
    </div>

    <script type="text/javascript">
      // Create Tabulator table
      $("#log-pane").tabulator({
        layout: "fitDataStretch", // Adjust column widths to fit content
        layoutColumnsOnNewData: true,
        columns: [
          {
            title: "Time",
            field: "time",
            sorter: "time",
            sorterParams: { format: "HH:mm:ss" },
            minWidth: 80,
          },
          {
            title: "Level",
            field: "level",
            headerFilter: "list",
            headerFilterParams: {
              values: ["INFO", "ERROR"],
            },
            headerSort: false,
            minWidth: 80,
          },
          {
            title: "Message",
            headerFilter: true,
            headerSort: false,
            field: "message",
            formatter: "textarea",
            variableHeight: true,
          },
        ],
        initialSort: [
          { column: "time", dir: "desc" }, // Initial sort by time descending
        ],
      });
      const toggleLogsButton = document.getElementById("toggleLogs");
      const logPane = document.getElementById("log-pane");

      toggleLogsButton.addEventListener("click", () => {
        if (logPane.style.display === "none") {
          logPane.style.display = "block"; // Or 'inline' depending on your layout
        } else {
          logPane.style.display = "none";
        }
      });
      const tabs = document.querySelectorAll(".tab");
      const tabContents = document.querySelectorAll(".tab-content");
      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          // Remove active class from all tabs and content
          tabs.forEach((t) => t.classList.remove("active"));
          tabContents.forEach((tc) => tc.classList.remove("active"));

          // Add active class to clicked tab and corresponding content
          tab.classList.add("active");
          document.getElementById(tab.dataset.target).classList.add("active");
        });
      });
    </script>
  </body>
</html>
